___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "categories": [
    "ANALYTICS"
  ],
  "displayName": "Mixpanel",
  "brand": {
    "id": "github.com_mixpanel",
    "displayName": "mixpanel",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Template for deploying the Mixpanel JavaScript SDK and utilizing the JavaScript API on the web page.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "token",
    "displayName": "Project Token",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "You can get the Project Token from \u003ca href\u003d\"https://mixpanel.com/settings/project\" target\u003d\"_blank\"\u003eproject settings\u003c/a\u003e.",
    "alwaysInSummary": true
  },
  {
    "type": "SELECT",
    "name": "type",
    "displayName": "Tag Type",
    "selectItems": [
      {
        "value": "group",
        "displayValue": "– Group"
      },
      {
        "value": "people",
        "displayValue": "– People"
      },
      {
        "value": "track",
        "displayValue": "– Track"
      },
      {
        "value": "pageview",
        "displayValue": "– Track Pageview"
      },
      {
        "value": "alias",
        "displayValue": "alias"
      },
      {
        "value": "clear_opt_in_out_tracking",
        "displayValue": "clear_opt_in_out_tracking"
      },
      {
        "value": "disable",
        "displayValue": "disable"
      },
      {
        "value": "identify",
        "displayValue": "identify"
      },
      {
        "value": "opt_in_tracking",
        "displayValue": "opt_in_tracking"
      },
      {
        "value": "opt_out_tracking",
        "displayValue": "opt_out_tracking"
      },
      {
        "value": "register",
        "displayValue": "register"
      },
      {
        "value": "register_once",
        "displayValue": "register_once"
      },
      {
        "value": "reset",
        "displayValue": "reset"
      },
      {
        "value": "set_config",
        "displayValue": "set_config"
      },
      {
        "value": "time_event",
        "displayValue": "time_event"
      },
      {
        "value": "track_forms",
        "displayValue": "track_forms"
      },
      {
        "value": "track_links",
        "displayValue": "track_links"
      },
      {
        "value": "unregister",
        "displayValue": "unregister"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "track"
  },
  {
    "type": "GROUP",
    "name": "groupOptions",
    "displayName": "Group Options",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "groupCommand",
        "displayName": "Command",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "add_group",
            "displayValue": "– add_group"
          },
          {
            "value": "remove_group",
            "displayValue": "– remove_group"
          },
          {
            "value": "set_group",
            "displayValue": "– set_group"
          },
          {
            "value": "group.remove",
            "displayValue": "group.remove"
          },
          {
            "value": "group.set",
            "displayValue": "group.set"
          },
          {
            "value": "group.set_once",
            "displayValue": "group.set_once"
          },
          {
            "value": "group.union",
            "displayValue": "group.union"
          },
          {
            "value": "group.unset",
            "displayValue": "group.unset"
          }
        ],
        "simpleValueType": true,
        "help": "Choose the type of \u003cstrong\u003egroup\u003c/strong\u003e command you wish to use. For more details, consult \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelgroup\"\u003ethis reference\u003c/a\u003e."
      },
      {
        "type": "TEXT",
        "name": "groupKey",
        "displayName": "Group Key",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "groupId",
        "displayName": "Group ID",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "groupCommand",
            "paramValue": "set_group",
            "type": "NOT_EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "groupIds",
        "displayName": "Group IDs",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "groupCommand",
            "paramValue": "set_group",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Enter either a single group ID or a comma-separated list of IDs. In the latter case, the user will be registered to all the group IDs listed."
      },
      {
        "type": "TEXT",
        "name": "groupProperty",
        "displayName": "Property Name",
        "simpleValueType": true,
        "help": "Enter the name of the property.",
        "enablingConditions": [
          {
            "paramName": "groupCommand",
            "paramValue": "group.remove",
            "type": "EQUALS"
          },
          {
            "paramName": "groupCommand",
            "paramValue": "group.union",
            "type": "EQUALS"
          },
          {
            "paramName": "groupCommand",
            "paramValue": "group.unset",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "groupValue",
        "displayName": "Value",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Enter the value to remove from the given property.",
        "enablingConditions": [
          {
            "paramName": "groupCommand",
            "paramValue": "group.remove",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "groupUnionValue",
        "displayName": "Values",
        "simpleValueType": true,
        "help": "Enter either a single value or a comma-separated list of values to merge with the given property.",
        "enablingConditions": [
          {
            "paramName": "groupCommand",
            "paramValue": "group.union",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "groupPropertyTable",
        "displayName": "Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add Property",
        "help": "Enter property names and their respective values that you want to set for the given group. Enter each property-value combination as its own row in the table.",
        "enablingConditions": [
          {
            "paramName": "groupCommand",
            "paramValue": "group.set",
            "type": "EQUALS"
          },
          {
            "paramName": "groupCommand",
            "paramValue": "group.set_once",
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "group",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "peopleOptions",
    "displayName": "People Options",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "peopleCommand",
        "displayName": "Command",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "people.append",
            "displayValue": "people.append"
          },
          {
            "value": "people.clear_charges",
            "displayValue": "people.clear_charges"
          },
          {
            "value": "people.delete_user",
            "displayValue": "people.delete_user"
          },
          {
            "value": "people.increment",
            "displayValue": "people.increment"
          },
          {
            "value": "people.remove",
            "displayValue": "people.remove"
          },
          {
            "value": "people.set",
            "displayValue": "people.set"
          },
          {
            "value": "people.set_once",
            "displayValue": "people.set_once"
          },
          {
            "value": "people.track_charge",
            "displayValue": "people.track_charge"
          },
          {
            "value": "people.union",
            "displayValue": "people.union"
          },
          {
            "value": "people.unset",
            "displayValue": "people.unset"
          }
        ],
        "simpleValueType": true,
        "help": "Choose the \u003cstrong\u003epeople\u003c/strong\u003e command you wish to use. For more information, consult \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelpeople\"\u003ethis reference\u003c/a\u003e."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "peopleAppendUnionTable",
        "displayName": "Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "help": "If you want to attach an array of values to the property, you can provide them as a comma-separated string. For example typing \u003cstrong\u003e1,2,3,4,5\u003c/strong\u003e would be automatically translated to \u003cstrong\u003e[1,2,3,4,5]\u003c/strong\u003e.",
        "enablingConditions": [
          {
            "paramName": "peopleCommand",
            "paramValue": "people.append",
            "type": "EQUALS"
          },
          {
            "paramName": "peopleCommand",
            "paramValue": "people.union",
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add Property"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "peopleIncrementTable",
        "displayName": "Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Increment By",
            "name": "value",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NUMBER"
              }
            ]
          }
        ],
        "enablingConditions": [
          {
            "paramName": "peopleCommand",
            "paramValue": "people.increment",
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add Property"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "peopleRemoveSetSetOnceTable",
        "displayName": "Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add Property",
        "enablingConditions": [
          {
            "paramName": "peopleCommand",
            "paramValue": "people.remove",
            "type": "EQUALS"
          },
          {
            "paramName": "peopleCommand",
            "paramValue": "people.set",
            "type": "EQUALS"
          },
          {
            "paramName": "peopleCommand",
            "paramValue": "people.set_once",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "peopleChargeAmount",
        "displayName": "Amount",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "peopleCommand",
            "paramValue": "people.track_charge",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "peopleChargeOptions",
        "displayName": "Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add Property",
        "enablingConditions": [
          {
            "paramName": "peopleCommand",
            "paramValue": "people.track_charge",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "peopleUnsetProperties",
        "displayName": "Property Name(s)",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Enter the name of the property to unset. If you want to unset multiple properties, enter them as a comma-separated string, e.g. \u003cstrong\u003egender,name\u003c/strong\u003e.",
        "enablingConditions": [
          {
            "paramName": "peopleCommand",
            "paramValue": "people.unset",
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "people",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "trackOptions",
    "displayName": "Track Options",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "trackEventName",
        "displayName": "Event Name",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "trackParameters",
        "displayName": "Parameters (Optional)",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "trackWithGroups",
        "checkboxText": "Track With Groups",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "SELECT",
        "name": "trackMethod",
        "displayName": "Transport Method",
        "selectItems": [
          {
            "value": "xhr",
            "displayValue": "xhr"
          },
          {
            "value": "sendBeacon",
            "displayValue": "sendBeacon"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "trackWithGroups",
            "paramValue": false,
            "type": "EQUALS"
          }
        ],
        "defaultValue": "xhr"
      },
      {
        "type": "CHECKBOX",
        "name": "trackImmediately",
        "checkboxText": "Send Immediately",
        "simpleValueType": true,
        "help": "Check to ignore the batching logic and send the hit immediately.",
        "enablingConditions": [
          {
            "paramName": "trackWithGroups",
            "paramValue": false,
            "type": "EQUALS"
          }
        ],
        "defaultValue": false
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "trackGroups",
        "displayName": "Groups",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Group Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value(s)",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "trackWithGroups",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "help": "Add group names and the values you want to track to. You can add multiple values for any group by passing the values in a comma-separated string, e.g. \u003cstrong\u003e1,2,5,7,8\u003c/strong\u003e.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "newRowButtonText": "Add Group"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "track",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "track_with_groups",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "trackPageviewOptions",
    "displayName": "Optional Parameters",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "trackPageviewParameters",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "trackPageviewAdditionalEventOptions",
        "checkboxText": "Add additional event options",
        "simpleValueType": true,
        "help": "Check this box to add additional event options to the \u003cstrong\u003etrack_pageview\u003c/strong\u003e call. For example, the event option \u003cstrong\u003eevent_name\u003c/strong\u003e lets you use a custom event name for the pageview ping."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "trackPageviewEventOptions",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Option name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Option value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "trackPageviewAdditionalEventOptions",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "pageview",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "aliasAlias",
    "displayName": "Alias",
    "simpleValueType": true,
    "help": "\u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelalias\"\u003eClick here for more information\u003c/a\u003e.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "alias",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "aliasOriginal",
    "displayName": "Original (optional)",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "alias",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "optOptions",
    "displayName": "Options (optional)",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "help": "Select a GTM variable that returns a valid Options object. \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelopt_in_tracking\"\u003eClick here for an example\u003c/a\u003e.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "clear_opt_in_out_tracking",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "opt_in_tracking",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "opt_out_tracking",
        "type": "EQUALS"
      }
    ],
    "notSetText": "Don\u0027t set an Options object"
  },
  {
    "type": "TEXT",
    "name": "disableEvents",
    "displayName": "Events (Optional)",
    "simpleValueType": true,
    "help": "Enter a comma-separated list of event names to disable tracking for. You can leave the field empty in which case tracking is disabled for all events. \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpaneldisable\"\u003eClick here for more information\u003c/a\u003e.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "disable",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "identifyId",
    "displayName": "Unique ID (Optional)",
    "simpleValueType": true,
    "help": "Enter a unique ID with which to identify the current user. \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelidentify\"\u003eClick here for more information\u003c/a\u003e.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "registerProperties",
    "displayName": "Properties",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Property Name",
        "name": "name",
        "type": "TEXT",
        "isUnique": true
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "newRowButtonText": "Add Property",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "register",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "register_once",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Add the properties you want to register as well as the days since the last visit to store the user\u0027s super properties. \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelregister_once\"\u003eClick here for more information\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "registerDays",
    "displayName": "Days (Optional)",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "register",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "register_once",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_NEGATIVE_NUMBER"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "registerDefaultValue",
    "displayName": "Default Value (Optional)",
    "simpleValueType": true,
    "help": "Enter the value to override if already set in super properties. \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelregister_once\"\u003eClick here for more information.\u003c/a\u003e",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "register_once",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "setConfigOptions",
    "displayName": "Config Options",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Option key",
        "name": "key",
        "type": "SELECT",
        "selectItems": [
          {
            "value": "api_method",
            "displayValue": "api_method"
          },
          {
            "value": "api_transport",
            "displayValue": "api_transport"
          },
          {
            "value": "batch_requests",
            "displayValue": "batch_requests"
          },
          {
            "value": "batch_size",
            "displayValue": "batch_size"
          },
          {
            "value": "batch_flush_interval_ms",
            "displayValue": "batch_flush_interval_ms"
          },
          {
            "value": "batch_request_timeout_ms",
            "displayValue": "batch_request_timeout_ms"
          },
          {
            "value": "cookie_domain",
            "displayValue": "cookie_domain"
          },
          {
            "value": "cookie_expiration",
            "displayValue": "cookie_expiration"
          },
          {
            "value": "cross_site_cookie",
            "displayValue": "cross_site_cookie"
          },
          {
            "value": "cross_subdomain_cookie",
            "displayValue": "cross_subdomain_cookie"
          },
          {
            "value": "debug",
            "displayValue": "debug"
          },
          {
            "value": "disable_persistence",
            "displayValue": "disable_persistence"
          },
          {
            "value": "ip",
            "displayValue": "ip"
          },
          {
            "value": "opt_out_tracking_by_default",
            "displayValue": "opt_out_tracking_by_default"
          },
          {
            "value": "opt_out_persistence_by_default",
            "displayValue": "opt_out_persistence_by_default"
          },
          {
            "value": "opt_out_tracking_persistence_type",
            "displayValue": "opt_out_tracking_persistence_type"
          },
          {
            "value": "opt_out_tracking_cookie_prefix",
            "displayValue": "opt_out_tracking_cookie_prefix"
          },
          {
            "value": "persistence",
            "displayValue": "persistence"
          },
          {
            "value": "persistence_name",
            "displayValue": "persistence_name"
          },
          {
            "value": "property_blacklist",
            "displayValue": "property_blacklist"
          },
          {
            "value": "secure_cookie",
            "displayValue": "secure_cookie"
          },
          {
            "value": "track_links_timeout",
            "displayValue": "track_links_timeout"
          },
          {
            "value": "upgrade",
            "displayValue": "upgrade"
          },
          {
            "value": "xhr_headers",
            "displayValue": "xhr_headers"
          },
          {
            "value": "inapp_protocol",
            "displayValue": "inapp_protocol"
          },
          {
            "value": "inapp_link_new_window",
            "displayValue": "inapp_link_new_window"
          },
          {
            "value": "ignore_dnt",
            "displayValue": "ignore_dnt"
          }
        ],
        "isUnique": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "defaultValue": "",
        "displayName": "Option value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "newRowButtonText": "Add option",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "set_config",
        "type": "EQUALS"
      }
    ],
    "help": "For each option, click the \u003cstrong\u003eAdd option\u003c/strong\u003e button. Select the option name from the drop-down list, and set the value to whatever you want the option to be. \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelset_config\"\u003eClick here for more information\u003c/a\u003e.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "timeEventName",
    "displayName": "Event Name",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Event name to trigger the timing for. \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpaneltime_event\"\u003eClick here for more information\u003c/a\u003e.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "time_event",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "trackFormsLinksQuery",
    "displayName": "Query String",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "track_forms",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "track_links",
        "type": "EQUALS"
      }
    ],
    "help": "Add a CSS selector string to match the elements you want to track.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "trackFormsLinksEventName",
    "displayName": "Event Name",
    "simpleValueType": true,
    "help": "Enter the name of the event to track.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "track_forms",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "track_links",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "trackFormsLinksProperties",
    "displayName": "Properties (Optional)",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Property Name",
        "name": "name",
        "type": "TEXT",
        "isUnique": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "defaultValue": "",
        "displayName": "Property Value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "track_forms",
        "type": "EQUALS"
      },
      {
        "paramName": "type",
        "paramValue": "track_links",
        "type": "EQUALS"
      }
    ],
    "newRowButtonText": "Add Property",
    "help": "Dictionary of properties to send with the event."
  },
  {
    "type": "TEXT",
    "name": "unregisterProperty",
    "displayName": "Property Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "unregister",
        "type": "EQUALS"
      }
    ],
    "help": "Enter super property name to unregister.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "initGroup",
    "displayName": "Initialization",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "instanceName",
        "displayName": "Library Name",
        "simpleValueType": true,
        "valueHint": "Default (blank)",
        "help": "Each \u003cstrong\u003einstance\u003c/strong\u003e is initialized just once per page. It doesn\u0027t hurt to add the initialization options to all your Mixpanel tags, but for each library name, only the first tag that fires will be considered for initialization options. To associate your tags with a specific instance, make sure you have this Library Name field populated correctly for these ags. For more details, \u003ca href\u003d\"https://developer.mixpanel.com/docs/javascript-full-api-reference#mixpanelinit\"\u003esee this page\u003c/a\u003e."
      },
      {
        "type": "SELECT",
        "name": "initOptions",
        "displayName": "Initialization Options",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "manual",
            "displayValue": "Set options manually"
          }
        ],
        "simpleValueType": true,
        "notSetText": "Use default values",
        "subParams": [],
        "help": "If you select \u003cstrong\u003eUse default values\u003c/strong\u003e, then the initialization is done with \u003ca href\u003d\"https://github.com/mixpanel/mixpanel-js/blob/master/src/mixpanel-core.js#L85\"\u003ethe default values\u003c/a\u003e.\u003cbr/\u003e\u003cbr/\u003e\nYou can also select a \u003cstrong\u003e{{GTM variable}}\u003c/strong\u003e from the list, which needs to return an object that has the key-value pairs you want to configure the instance with. You can find the key-value pairs following \u003ca https://github.com/mixpanel/mixpanel-js/blob/master/src/mixpanel-core.js#L85\"\u003ethis example\u003c/a\u003e.\u003cbr/\u003e\u003cbr/\u003eFinally, you can \u003cstrong\u003eSet options manually\u003c/strong\u003e in the tag itself, by selecting the corresponding option."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "initManualOptions",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Option key",
            "name": "key",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "api_host",
                "displayValue": "api_host"
              },
              {
                "value": "api_method",
                "displayValue": "api_method"
              },
              {
                "value": "api_transport",
                "displayValue": "api_transport"
              },
              {
                "value": "app_host",
                "displayValue": "app_host"
              },
              {
                "value": "cdn",
                "displayValue": "cdn"
              },
              {
                "value": "cross_site_cookie",
                "displayValue": "cross_site_cookie"
              },
              {
                "value": "cross_subdomain_cookie",
                "displayValue": "cross_subdomain_cookie"
              },
              {
                "value": "persistence",
                "displayValue": "persistence"
              },
              {
                "value": "persistence_name",
                "displayValue": "persistence_name"
              },
              {
                "value": "cookie_domain",
                "displayValue": "cookie_domain"
              },
              {
                "value": "cookie_name",
                "displayValue": "cookie_name"
              },
              {
                "value": "loaded",
                "displayValue": "loaded"
              },
              {
                "value": "store_google",
                "displayValue": "store_google"
              },
              {
                "value": "stop_utm_persistence",
                "displayValue": "stop_utm_persistence"
              },
              {
                "value": "save_referrer",
                "displayValue": "save_referrer"
              },
              {
                "value": "test",
                "displayValue": "test"
              },
              {
                "value": "verbose",
                "displayValue": "verbose"
              },
              {
                "value": "img",
                "displayValue": "img"
              },
              {
                "value": "debug",
                "displayValue": "debug"
              },
              {
                "value": "track_links_timeout",
                "displayValue": "track_links_timeout"
              },
              {
                "value": "cookie_expiration",
                "displayValue": "cookie_expiration"
              },
              {
                "value": "upgrade",
                "displayValue": "upgrade"
              },
              {
                "value": "disable_persistence",
                "displayValue": "disable_persistence"
              },
              {
                "value": "disable_cookie",
                "displayValue": "disable_cookie"
              },
              {
                "value": "secure_cookie",
                "displayValue": "secure_cookie"
              },
              {
                "value": "ip",
                "displayValue": "ip"
              },
              {
                "value": "opt_out_tracking_by_default",
                "displayValue": "opt_out_tracking_by_default"
              },
              {
                "value": "opt_out_persistence_by_default",
                "displayValue": "opt_out_persistence_by_default"
              },
              {
                "value": "opt_out_tracking_persistence_type",
                "displayValue": "opt_out_tracking_persistence_type"
              },
              {
                "value": "opt_out_tracking_cookie_prefix",
                "displayValue": "opt_out_tracking_cookie_prefix"
              },
              {
                "value": "property_blacklist",
                "displayValue": "property_blacklist"
              },
              {
                "value": "xhr_headers",
                "displayValue": "xhr_headers"
              },
              {
                "value": "inapp_protocol",
                "displayValue": "inapp_protocol"
              },
              {
                "value": "inapp_link_new_window",
                "displayValue": "inapp_link_new_window"
              },
              {
                "value": "ignore_dnt",
                "displayValue": "ignore_dnt"
              },
              {
                "value": "batch_requests",
                "displayValue": "batch_requests"
              },
              {
                "value": "batch_size",
                "displayValue": "batch_size"
              },
              {
                "value": "batch_flush_interval_ms",
                "displayValue": "batch_flush_interval_ms"
              },
              {
                "value": "batch_request_timeout_ms",
                "displayValue": "batch_request_timeout_ms"
              },
              {
                "value": "batch_autostart",
                "displayValue": "batch_autostart"
              },
              {
                "value": "hooks",
                "displayValue": "hooks"
              },
              {
                "value": "skip_first_touch_marketing",
                "displayValue": "skip_first_touch_marketing"
              },
              {
                "value": "track_marketing",
                "displayValue": "track_marketing"
              },
              {
                "value": "track_pageview",
                "displayValue": "track_pageview"
              },
              {
                "value": "record_block_class",
                "displayValue": "record_block_class"
              },
              {
                "value": "record_block_selector",
                "displayValue": "record_block_selector"
              },
              {
                "value": "record_idle_timeout_ms",
                "displayValue": "record_idle_timeout_ms"
              },
              {
                "value": "record_mask_text_class",
                "displayValue": "record_mask_text_class"
              },
              {
                "value": "record_mask_text_selector",
                "displayValue": "record_mask_text_selector"
              },
              {
                "value": "record_max_ms",
                "displayValue": "record_max_ms"
              },
              {
                "value": "record_sessions_percent",
                "displayValue": "record_sessions_percent"
              },
              {
                "value": "recorder_src",
                "displayValue": "recorder_src"
              }
            ],
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Option value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add option",
        "enablingConditions": [
          {
            "paramName": "initOptions",
            "paramValue": "manual",
            "type": "EQUALS"
          }
        ],
        "help": "For each option, click the \u003cstrong\u003eAdd option\u003c/strong\u003e button. Select the option name from the drop-down list, and set the value to whatever you want the option to be. Boolean values (e.g. \u003cstrong\u003etrue\u003c/strong\u003e and \u003cstrong\u003efalse\u003c/strong\u003e) are automatically converted from strings to Booleans by the template code. Similarly, number values (e.g. \u003cstrong\u003e365\u003c/strong\u003e) are automatically converted to numbers by the template code. Functions, objects, and other non-string types need to be passed using a GTM variable, selected from the list."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// APIs
const callInWindow = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const getType = require('getType');
const injectScript = require('injectScript');
const log = require('logToConsole');
const makeNumber = require('makeNumber');
const makeString = require('makeString');
const makeTableMap = require('makeTableMap');
const templateStorage = require('templateStorage');

// Constants
const INSTANCES_STORAGE_KEY = 'mixpanel_instances';
const JS_URL = 'https://cdn.mxpnl.com/libs/mixpanel-js-wrapper.js';
const LOG_PREFIX = '[Mixpanel / GTM] ';
const WRAPPER_NAMESPACE = '_mixpanel';

// Helpers

// Print a log message and set the tag to failed state
const fail = msg => {
  log(LOG_PREFIX + 'Error: ' + msg);
  return data.gtmOnFailure();
};

// Normalize the input and return it
const normalize = val => {
  if (val === 'null') return null;
  if (val === 'true' || val === true) return true;
  if (val === 'false' || val === false) return false;
  return makeNumber(val) || val;
};

// Normalize the template table
const normalizeTable = (table, prop, val) => {
  if (table && table.length) {
    table = table.map(row => {
      const obj = {};
      obj[prop] = row[prop];
      obj[val] = normalize(row[val]);
      return obj;
    });
    return makeTableMap(table, prop, val);
  }
  return false;
};


// Split a string into an array and trim the constituents of leading and trailing whitespace
const stringToArrayAndTrim = str => str.split(',').map(n => makeString(n.trim()));

// Convenience method for logging calls to the wrapper
const callMixpanel = function() {
  callInWindow('_mixpanel.apply', null, arguments);
};

// User input
const libraryName = data.instanceName ? data.instanceName + '.' : '';

// Build and normalize initialization options map
const manualOptions = normalizeTable(data.initManualOptions, 'key', 'value') || {};

const initOptions = Object.assign({'mp_loader': 'gtm'}, (data.initOptions === 'manual' ? manualOptions : data.initOptions) || {});

// Initialize the instance if necessary
const initializeInstance = () => {
  const instancesInStorage = templateStorage.getItem(INSTANCES_STORAGE_KEY) || [];
  if (instancesInStorage.indexOf(data.instanceName) === -1) {
    callInWindow('mixpanel.init', data.token, initOptions, data.instanceName);
    instancesInStorage.push(data.instanceName);
    templateStorage.setItem(INSTANCES_STORAGE_KEY, instancesInStorage);
  }
  return;
};

const onfailure = () => {
  return fail('Failed to load the Mixpanel JavaScript library');
};

const onsuccess = () => {

  const _mixpanel = copyFromWindow(WRAPPER_NAMESPACE);
  if (!_mixpanel) return fail('Failed to load the Mixpanel wrapper');

  initializeInstance();

  switch (data.type) {

    // Process add_group, remove_group, set_group, and group.* commands
    case 'group':
      const groupCommand = libraryName + data.groupCommand;
      if (['add_group', 'remove_group', 'set_group'].indexOf(data.groupCommand) > -1) {
        callMixpanel(
          groupCommand,
          data.groupKey,
          data.groupCommand === 'set_group' ? stringToArrayAndTrim(data.groupIds) : data.groupId
        );
      } else if (['group.remove', 'group.union'].indexOf(data.groupCommand) > -1) {
        callMixpanel(
          groupCommand,
          [data.groupKey, data.groupId],
          data.groupProperty,
          data.groupCommand === 'group.union' ? stringToArrayAndTrim(data.groupUnionValue) : data.groupValue
        );
      } else if (data.groupCommand === 'group.unset') {
        callMixpanel(
          groupCommand,
          [data.groupKey, data.groupId],
          data.groupProperty
        );
      } else {
        const groupProperties = normalizeTable(data.groupPropertyTable, 'name', 'value');
        if (groupProperties) {
          callMixpanel(
            groupCommand,
            [data.groupKey, data.groupId],
            groupProperties
          );
        }
      }
      break;

    // Process people.* commands
    case 'people':
      const peopleCommand = libraryName + data.peopleCommand;
      if (['people.append', 'people.union'].indexOf(data.peopleCommand) > -1) {
        const appendUnionTable = data.peopleAppendUnionTable && data.peopleAppendUnionTable.length ?
          data.peopleAppendUnionTable.map(row => {
            return {
              name: row.name,
              value: stringToArrayAndTrim(row.value)
            };
          }) : [];
        callMixpanel(
          peopleCommand,
          normalizeTable(appendUnionTable, 'name', 'value')
        );
      } else if (['people.clear_charges', 'people.delete_user'].indexOf(data.peopleCommand) > -1) {
        callMixpanel(
          peopleCommand
        );
      } else if (data.peopleCommand === 'people.increment') {
        callMixpanel(
          peopleCommand,
          normalizeTable(data.peopleIncrementTable, 'name', 'value')
        );
      } else if (['people.remove', 'people.set', 'people.set_once'].indexOf(data.peopleCommand) > -1) {
        callMixpanel(
          peopleCommand,
          normalizeTable(data.peopleRemoveSetSetOnceTable, 'name', 'value')
        );
      } else if (data.peopleCommand === 'people.track_charge') {
        callMixpanel(
          peopleCommand,
          normalize(data.peopleChargeAmount),
          normalizeTable(data.peopleChargeOptions, 'name', 'value')
        );
      } else {
        callMixpanel(
          peopleCommand,
          stringToArrayAndTrim(data.peopleUnsetProperties)
        );
      }
      break;

    // Process track and track_with_groups commands
    case 'track':
      const trackProperties = normalizeTable(data.trackParameters, 'name', 'value') || {};
      if (!data.trackWithGroups) {
        callMixpanel(
          libraryName + 'track',
          data.trackEventName,
          trackProperties,
          {
            transport: data.trackMethod,
            send_immediately: data.trackImmediately
          }
        );
      } else {
        const groups = data.trackGroups.map(group => {
          return {
            name: group.name,
            value: stringToArrayAndTrim(group.value)
          };
        });
        callMixpanel(
          libraryName + 'track_with_groups',
          data.trackEventName,
          trackProperties,
          normalizeTable(groups, 'name', 'value')
        );
      }
      break;

    // Process the track_pageview command
    case 'pageview':
      const trackPageviewProperties = normalizeTable(data.trackPageviewParameters, 'name', 'value') || {};
      const trackPageviewEventOptions = normalizeTable(data.trackPageviewEventOptions, 'name', 'value') || {};
      callMixpanel(
        libraryName + 'track_pageview',
        trackPageviewProperties,
        trackPageviewEventOptions
      );
      break;

    case 'alias':
      callMixpanel(
        libraryName + data.type,
        data.aliasAlias,
        data.aliasOriginal
      );
      break;

    // Process all three opt_* commands
    case 'clear_opt_in_out_tracking':
    case 'opt_in_tracking':
    case 'opt_out_tracking':
      callMixpanel(
        libraryName + data.type,
        getType(data.optOptions) === 'object' ? data.optOptions : null
      );
      break;

    case 'disable':
      if (data.disableEvents) {
        callMixpanel(
          libraryName + data.type,
          stringToArrayAndTrim(data.disableEvents)
        );
      } else {
        callMixpanel(libraryName + data.type);
      }
      break;

    case 'identify':
      if (data.identifyId) {
        callMixpanel(
          libraryName + data.type,
          data.identifyId
        );
      } else {
        callMixpanel(libraryName + data.type);
      }
      break;

    case 'register':
      callMixpanel(
        libraryName + data.type,
        normalizeTable(data.registerProperties, 'name', 'value'),
        data.registerDays
      );
      break;

    case 'register_once':
      callMixpanel(
        libraryName + data.type,
        normalizeTable(data.registerProperties, 'name', 'value'),
        data.registerDefaultValue,
        data.registerDays
      );
      break;

    case 'reset':
      callMixpanel(libraryName + data.type);
      break;

    case 'set_config':
      callMixpanel(
        libraryName + data.type,
        normalizeTable(data.setConfigOptions, 'key', 'value')
      );
      break;

    case 'time_event':
      callMixpanel(
        libraryName + data.type,
        data.timeEventName
      );
      break;

    case 'track_forms':
    case 'track_links':
      callMixpanel(
        libraryName + data.type,
        data.trackFormsLinksQuery,
        data.trackFormsLinksEventName,
        normalizeTable(data.trackFormsLinksProperties, 'name', 'value') || null
      );
      break;

    case 'unregister':
      callMixpanel(
        libraryName + data.type,
        data.unregisterProperty
      );
      break;
  }

  data.gtmOnSuccess();
};

// Check if namespace already exists
const _mixpanel = copyFromWindow(WRAPPER_NAMESPACE);
if (!_mixpanel) {
  injectScript(JS_URL, onsuccess, onfailure, 'mixpanel');
} else {
  onsuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_mixpanel"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "mixpanel.init"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_mixpanel.apply"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.mxpnl.com/libs/mixpanel-js-wrapper.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_template_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 27/10/2021, 18:34:01
